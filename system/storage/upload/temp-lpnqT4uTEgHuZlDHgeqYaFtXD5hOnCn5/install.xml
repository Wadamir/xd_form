<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name>XD VideoProduct for Opencart | ocStore 2.3.x</name>
	<code>xd_video</code>
	<version>1.0</version>
    <author><![CDATA[<span style="color:#0066cc"><b>XDomus.ru</b></span>]]></author>
    <link>//xdomus.ru/opencart/modul-stikery-dlya-opencart-besplatno/</link>
	<file path="admin/controller/catalog/product.php">
		<operation>
			<search>
				<![CDATA[
					$this->load->model('localisation/stock_status');
				]]>
			</search>
			<add position="before">
				<![CDATA[
					// XD VideoProduct start
						if (isset($this->request->post['video_link'])) {
                            $data['video_link'] = $this->request->post['video_link'];
                        } elseif (!empty($product_info)) {
                            $data['video_link'] = $product_info['video_link'];
                        } else {
                            $data['video_link'] = '';
                        }
					// XD VideoProduct end
				]]>
			</add>
		</operation>
	</file>
    <file path="admin/language/en-gb/catalog/product.php">
        <operation>
			<search>
				<![CDATA[
					$_['entry_description']      = 'Description';
				]]>
			</search>
			<add position="before">
				<![CDATA[
					$_['entry_video_link']      = 'Input Yandex Disk Video link';
				]]>
			</add>
		</operation>
    </file>
	<file path="admin/view/template/catalog/product_form.tpl">
		<operation>
			<search>
				<![CDATA[
					<div class="tab-pane" id="tab-data">
				]]>
			</search>
			<add position="after">
				<![CDATA[
					<!-- XD VideoProduct start -->
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="input-video_link"><?php echo $entry_video_link; ?></label>
                            <div class="col-sm-10">
                                <input type="text" name="video_link" value="<?php echo $video_link; ?>" placeholder="<?php echo $entry_video_link; ?>" id="input-video_link" class="form-control" />
                            </div>
                        </div>
					<!-- XD VideoProduct start -->
				]]>
			</add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation>
			<search>
				<![CDATA[
					$data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');
				]]>
			</search>
			<add position="after">
				<![CDATA[
					// XD VideoProduct start
                        // https://disk.yandex.ru/i/gOtUjKZp8Pz3uw
                        $data['yandex_video'] = '';
                        $video_link = isset($product_info['video_link']) ? $product_info['video_link'] : '';
                        if ($video_link && strpos($video_link, 'disk.yandex.ru') !== false) {
                            $video_link_array = explode('/', $video_link);
                            // last element of the array is the file name
                            $data['yandex_video'] = end($video_link_array);
                        }
                        if $data['yandex_video'] {
                            $data['description'] = '<div style="min-width: 100%"><div style="position: relative; padding-bottom: 56.25%; height: 0;"><iframe src="https://frontend.vh.yandex.ru/player/'. $data['yandex_video'] .'?from=partner" allow="autoplay; encrypted-media; screen-wake-lock" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe></div></div>' . $data['description'];
                        }
					// XD VideoProduct end
				]]>
			</add>
		</operation>
	</file>
</modification>